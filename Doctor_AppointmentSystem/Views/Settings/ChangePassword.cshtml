@model Doctor_AppointmentSystem.ViewModels.ChangePasswordViewModel

@* @{
    ViewData["Title"] = "Sunshine Hospital";
    Layout = "~/Views/Shared/_Layout_Admin.cshtml";
} *@

@@model Doctor_AppointmentSystem.ViewModels.ChangePasswordViewModel

@{
    ViewData["Title"] = "Change Password";

    // Default layout (for Admin)
    var layoutPath = "~/Views/Shared/_Layout_Admin.cshtml";

    if (User.IsInRole("Doctor"))
    {
        layoutPath = "~/Views/Shared/_Layout_Doctor.cshtml";
    }
    else if (User.IsInRole("Patient"))
    {
        layoutPath = "~/Views/Shared/_Layout_Patient.cshtml";
    }
    else if (User.IsInRole("Receptionist"))
    {
        layoutPath = "~/Views/Shared/_Layout_Receptionist.cshtml";
    }

    Layout = layoutPath;
}


@if (TempData["SuccessMessage"] != null)
{
    <div class="alert-success-soft">
        @TempData["SuccessMessage"]
    </div>
}

<div class="settings-page">
    <div class="form-wrapper">
        <div class="card form-card form-card--narrow">

            <div class="card-title-row card-title-row--compact">
                <div>
                    <h3>Change Password</h3>
                    <div class="card-title-sub">
                        Your new password will be used for all future logins.
                    </div>
                </div>
            </div>

            <form asp-action="ChangePassword" method="post">
                @Html.AntiForgeryToken()

                <!-- Current password -->
                <div class="form-field">
                    <label asp-for="CurrentPassword" class="form-label"></label>
                    <div class="password-wrapper">
                        <input asp-for="CurrentPassword"
                               id="CurrentPassword"
                               class="form-input password-input"
                               type="password" />
                        <button type="button"
                                class="password-toggle"
                                data-target="CurrentPassword"
                                aria-label="Show or hide current password">
                            👁
                        </button>
                    </div>
                    <span asp-validation-for="CurrentPassword" class="field-validation"></span>
                </div>

                <!-- New password -->
                <div class="form-field">
                    <label asp-for="NewPassword" class="form-label"></label>
                    <div class="password-wrapper">
                        <input asp-for="NewPassword"
                               id="NewPassword"
                               class="form-input password-input"
                               type="password" />
                        <button type="button"
                                class="password-toggle"
                                data-target="NewPassword"
                                aria-label="Show or hide new password">
                            👁
                        </button>
                    </div>
                    <span asp-validation-for="NewPassword" class="field-validation"></span>
                </div>

                <!-- Confirm password -->
                <div class="form-field">
                    <label asp-for="ConfirmPassword" class="form-label"></label>
                    <div class="password-wrapper">
                        <input asp-for="ConfirmPassword"
                               id="ConfirmPassword"
                               class="form-input password-input"
                               type="password" />
                        <button type="button"
                                class="password-toggle"
                                data-target="ConfirmPassword"
                                aria-label="Show or hide confirmation password">
                            👁
                        </button>
                    </div>
                    <span asp-validation-for="ConfirmPassword" class="field-validation"></span>
                </div>

                <div asp-validation-summary="All" class="field-validation"></div>

                <div class="form-actions" style="margin-top:20px;">
                    <button type="submit" class="search-btn">
                        Change Password
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            document.querySelectorAll(".password-toggle").forEach(function (btn) {

                const targetId = btn.getAttribute("data-target");
                const input = document.getElementById(targetId);
                if (!input) return;

                // WHEN BUTTON IS PRESSED → SHOW PASSWORD
                btn.addEventListener("mousedown", function () {
                    input.type = "text";
                    btn.classList.add("password-toggle--active");
                });

                // WHEN BUTTON IS RELEASED → HIDE PASSWORD
                btn.addEventListener("mouseup", function () {
                    input.type = "password";
                    btn.classList.remove("password-toggle--active");
                });

                // IF THEY DRAG AWAY WHILE PRESSING → ALSO HIDE PASSWORD
                btn.addEventListener("mouseleave", function () {
                    input.type = "password";
                    btn.classList.remove("password-toggle--active");
                });

                // MOBILE TOUCH SUPPORT
                btn.addEventListener("touchstart", function () {
                    input.type = "text";
                    btn.classList.add("password-toggle--active");
                });

                btn.addEventListener("touchend", function () {
                    input.type = "password";
                    btn.classList.remove("password-toggle--active");
                });

            });
        });
    </script>

}
