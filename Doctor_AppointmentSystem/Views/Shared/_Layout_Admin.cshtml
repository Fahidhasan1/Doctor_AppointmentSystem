@using Doctor_AppointmentSystem.Models
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> UserManager

@{
    // this is a layout file, so no parent layout
    Layout = null;

    // --- CURRENT USER INFO FOR SIDEBAR / TOPBAR ---
    var currentUser = await UserManager.GetUserAsync(User);

    var fullName = ((currentUser?.FirstName ?? "") + " " + (currentUser?.LastName ?? ""))
                   .Trim();

    // userName = what we show around the app (sidebar etc.)
    var userName = !string.IsNullOrWhiteSpace(fullName)
        ? fullName
        : (User.Identity?.Name ?? "Admin");

    // first letter for placeholder avatar
    var firstLetter = !string.IsNullOrWhiteSpace(userName)
        ? userName.Trim()[0].ToString().ToUpper()
        : "A";

    // profile image path from AspNetUsers, fallback to any ViewBag value if used
    var profileImagePath = currentUser?.ProfileImagePath
                           ?? (ViewBag.ProfileImagePath as string);

    // --- PAGE TITLES FOR TOPBAR ---
    var pageTitle = ViewData["Title"] as string ?? "Admin Dashboard";
    // var pageSubtitle = ViewData["Subtitle"] as string
    //                    ?? "Quick overview of roles, appointments and revenue.";

    // --- CURRENT DATE TEXT (already used in your layout) ---
    var currentDate = DateTime.Now.ToString("dddd, MMM dd, yyyy");
}






<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@(ViewData["Title"] ?? "Admin Dashboard | Doctor Appointment System")</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/admin-dashboard.css" asp-append-version="true" />
</head>
<body>
    <div class="admin-layout">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
               

                @if (!string.IsNullOrEmpty(profileImagePath))
                {
                    <img src="@Url.Content(profileImagePath)" alt="Profile" class="admin-avatar-img" />
                }
                else
                {
                    <div class="admin-avatar">@firstLetter</div>
                }


                <div class="sidebar-role">Admin</div>
                <div class="sidebar-username">@userName</div>
                <div class="sidebar-subtitle">Sunshine Hospital</div>
            </div>

            <nav class="sidebar-nav">
                <a asp-controller="AdminDashboard" asp-action="Index" class="nav-link active">
                    <div class="nav-link-icon">🏠</div>
                    <span>Dashboard</span>
                </a>

                <div class="nav-dropdown">
                    <div class="nav-dropdown-toggle" data-dropdown>
                        <div class="nav-dropdown-toggle-main">
                            <div class="nav-link-icon">👥</div>
                            <span>Manage Users</span>
                        </div>
                        <span class="nav-dropdown-arrow">▾</span>
                    </div>
                    <div class="nav-submenu">
                        <a asp-controller="AdminProfile" asp-action="Index" class="nav-link nav-link--sub">Admins</a>
                        <a asp-controller="AdminDoctor" asp-action="Index" class="nav-link nav-link--sub">Doctors</a>
                        <a asp-controller="AdminReceptionist" asp-action="Index" class="nav-link nav-link--sub">Receptionists</a>
                        <a asp-controller="AdminPatient" asp-action="Index" class="nav-link nav-link--sub">Patients</a>

                    </div>

                </div>

                <a asp-controller="AdminAppointment" asp-action="Index" class="nav-link">
                    <div class="nav-link-icon">📅</div>
                    <span>All Appointments</span>
                </a>

                <a asp-controller="AdminSpecialty" asp-action="Index" class="nav-link">
                    <div class="nav-link-icon">🏥</div>
                    <span>Doctor Specialties</span>
                </a>

                <a asp-controller="AdminPayment" asp-action="Index" class="nav-link">
                    <div class="nav-link-icon">💳</div>
                    <span>Payments &amp; Income</span>
                </a>

                

                <a asp-controller="AdminProfile" asp-action="Index" class="nav-link">
                    <div class="nav-link-icon">👤</div>
                    <span>My Profile</span>
                </a>

               
                <div class="nav-dropdown">
                    <div class="nav-dropdown-toggle" data-dropdown>
                        <div class="nav-dropdown-toggle-main">
                            <div class="nav-link-icon">⚙️</div>
                            <span>Settings</span>
                        </div>
                        <span class="nav-dropdown-arrow">▾</span>
                    </div>

                    <div class="nav-submenu">
                        <a asp-controller="Settings" asp-action="ChangePassword" class="nav-link nav-link--sub">
                            Change Password
                        </a>

                        
                    </div>
                </div>


                <form asp-controller="Account" asp-action="Logout" method="post" class="logout-form">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="nav-link nav-link-button">
                        <div class="nav-link-icon">🚪</div>
                        <span>Logout</span>
                    </button>
                </form>
            </nav>
        </aside>

        <!-- MAIN -->
        <main class="main">
            <header class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" id="menuToggle">☰</button>
                    <div>
                        <div class="topbar-title">@pageTitle</div>
                        @* <div class="topbar-subtext">
                            @pageSubtitle
                        </div> *@
                    </div>
                </div>
                <div class="topbar-right">
                    <div class="topbar-date" id="currentDate"></div>
                </div>
            </header>

            <section class="dashboard-content">
                @RenderBody()
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/admin-dashboard.js" asp-append-version="true"></script>
    @RenderSection("Scripts", required: false)

    @{
        var loginSuccess = TempData["LoginSuccess"] as string;
    }

    @if (!string.IsNullOrEmpty(loginSuccess))
    {
        <div class="toast-container">
            <div class="toast-message toast-success">
                @loginSuccess
            </div>
        </div>

        <script>
            setTimeout(function () {
                var el = document.querySelector('.toast-message');
                if (el) el.classList.add('toast-hide');
            }, 4000);
        </script>
    }


</body>
</html>
